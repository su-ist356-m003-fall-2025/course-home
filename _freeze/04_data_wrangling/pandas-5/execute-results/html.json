{
  "hash": "ed04bb3c6b984c542223b9e5189a2a4e",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"6. Grouping data and creating pivot tables with Pandas\"\njupyter: python3\nresources:\n    - assets/scratch-pandas-4.ipynb\n---\n\nIn this lesson you will learn how to group data together in a DataFrame and create summary statistics of the grouped data. You will also learn how to reshape a DataFrame, and create a pivot table.\n\nFor this lesson we will use the following data of (fake) exam scores:\n\n::: {#b5f34073 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nexams_data = 'https://raw.githubusercontent.com/mafudge/datasets/refs/heads/master/exam-scores/exam-scores.csv'\nexams = pd.read_csv(exams_data)\nexams.sample(10)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Class_Section</th>\n      <th>Exam_Version</th>\n      <th>Completion_Time</th>\n      <th>Made_Own_Study_Guide</th>\n      <th>Did_Exam_Prep Assignment</th>\n      <th>Studied_In_Groups</th>\n      <th>Student_Score</th>\n      <th>Percentage</th>\n      <th>Letter_Grade</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>62</th>\n      <td>M02</td>\n      <td>D</td>\n      <td>45</td>\n      <td>?</td>\n      <td>?</td>\n      <td>?</td>\n      <td>24</td>\n      <td>80.00%</td>\n      <td>B</td>\n    </tr>\n    <tr>\n      <th>64</th>\n      <td>M02</td>\n      <td>D</td>\n      <td>60</td>\n      <td>N</td>\n      <td>N</td>\n      <td>Y</td>\n      <td>24</td>\n      <td>80.00%</td>\n      <td>B</td>\n    </tr>\n    <tr>\n      <th>0</th>\n      <td>M01</td>\n      <td>A</td>\n      <td>20</td>\n      <td>N</td>\n      <td>N</td>\n      <td>Y</td>\n      <td>24</td>\n      <td>80.00%</td>\n      <td>B</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>M01</td>\n      <td>B</td>\n      <td>15</td>\n      <td>Y</td>\n      <td>Y</td>\n      <td>Y</td>\n      <td>26</td>\n      <td>86.70%</td>\n      <td>B+</td>\n    </tr>\n    <tr>\n      <th>44</th>\n      <td>M02</td>\n      <td>B</td>\n      <td>45</td>\n      <td>Y</td>\n      <td>Y</td>\n      <td>Y</td>\n      <td>25</td>\n      <td>83.30%</td>\n      <td>B</td>\n    </tr>\n    <tr>\n      <th>26</th>\n      <td>M01</td>\n      <td>D</td>\n      <td>60</td>\n      <td>Y</td>\n      <td>Y</td>\n      <td>N</td>\n      <td>19</td>\n      <td>63.30%</td>\n      <td>C-</td>\n    </tr>\n    <tr>\n      <th>39</th>\n      <td>M02</td>\n      <td>B</td>\n      <td>15</td>\n      <td>N</td>\n      <td>N</td>\n      <td>Y</td>\n      <td>19</td>\n      <td>63.30%</td>\n      <td>C-</td>\n    </tr>\n    <tr>\n      <th>46</th>\n      <td>M02</td>\n      <td>B</td>\n      <td>55</td>\n      <td>Y</td>\n      <td>N</td>\n      <td>N</td>\n      <td>17</td>\n      <td>56.70%</td>\n      <td>D</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>M01</td>\n      <td>D</td>\n      <td>35</td>\n      <td>?</td>\n      <td>?</td>\n      <td>?</td>\n      <td>13</td>\n      <td>43.30%</td>\n      <td>F</td>\n    </tr>\n    <tr>\n      <th>52</th>\n      <td>M02</td>\n      <td>C</td>\n      <td>40</td>\n      <td>Y</td>\n      <td>Y</td>\n      <td>N</td>\n      <td>16</td>\n      <td>53.30%</td>\n      <td>D</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nTo follow along with the commands below, download the following scratch notebook to your `ist356` directory, then open it with VS Code:\n\n<a href=\"../assets/scratch-pandas-5.ipynb\">Download scratch-pandas-5.ipynb</a>\n\nThis has the `exams_data` URL in it.\n\n## Group By\n\nWith large data sets we frequently want to group common data together and summarize those groups in some way.\nFor example, you might want to know:\n\n- Average exam score by section\n- Number of students who took each exam\n- Average grade based on whether students studied in groups\n- Total completion time by letter grade\n\n\nThe Pandas [groupby](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.groupby.html) method allows us to quickly group data like this. Using it involves two steps:\n\n1. Run the `groupby` method on a dataframe, giving it a column or list of columns to group the data by.\n2. The `groupby` method returns an `DataFrameGroupBy` object. On its own, this object isn't terrible informative. To get something useful, we then use the aggregate method (`agg`) to summarize the grouped data and display it as a DataFrame. When aggregating the data, we need to provide the name of an operation (`sum, min, max, mean, std, quartile, count`) by which to summarizie the data.\n\nHere's an example using our exams data:\n\n::: {#21c97340 .cell execution_count=2}\n``` {.python .cell-code}\n# Example: Total number of exams take by section and the average score in each section:\nexams_by_section = exams.groupby(by=['Class_Section']).agg({ 'Class_Section': 'count', 'Student_Score': 'mean' })\nexams_by_section\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Class_Section</th>\n      <th>Student_Score</th>\n    </tr>\n    <tr>\n      <th>Class_Section</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>M01</th>\n      <td>29</td>\n      <td>23.000000</td>\n    </tr>\n    <tr>\n      <th>M02</th>\n      <td>36</td>\n      <td>22.527778</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nHere, we've chosen to group the exams by the class section. We've then produced a DataFrame in which the class sections are summarized by the number of students and their average score. The column names are a little confusing, however. Let's rename them to make the output more readable:\n\n::: {#e29a02fa .cell execution_count=3}\n``` {.python .cell-code}\nexams_by_section = exams.groupby(by=['Class_Section']).agg({ 'Class_Section': 'count', 'Student_Score': 'mean' })\nexams_by_section = exams_by_section.rename(columns={'Class_Section': 'Exam_Count', 'Student_Score': 'Average_Score'})\nexams_by_section\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Exam_Count</th>\n      <th>Average_Score</th>\n    </tr>\n    <tr>\n      <th>Class_Section</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>M01</th>\n      <td>29</td>\n      <td>23.000000</td>\n    </tr>\n    <tr>\n      <th>M02</th>\n      <td>36</td>\n      <td>22.527778</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nNote that the grouped columns end up in the [index](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.index.html) method to add the grouped columns back as a column:\n\n::: {#94afcc38 .cell execution_count=4}\n``` {.python .cell-code}\nexams_by_section['Class_Section'] = exams_by_section.index\nexams_by_section\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Exam_Count</th>\n      <th>Average_Score</th>\n      <th>Class_Section</th>\n    </tr>\n    <tr>\n      <th>Class_Section</th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>M01</th>\n      <td>29</td>\n      <td>23.000000</td>\n      <td>M01</td>\n    </tr>\n    <tr>\n      <th>M02</th>\n      <td>36</td>\n      <td>22.527778</td>\n      <td>M02</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::: {.callout-caution appearance=\"simple\" icon=\"false\"}\n### Code Challenge 6.1\n\nCreate a Streamlit app that will load the exams csv file above and will allow the user to select one of the following: `Made_Own_Study_Guide`, `Did_Exam_Prep Assignment`, `Studied_In_Groups`. After the selection is made, display a dataframe that summarizes the count of students and the average student score for the selection.\n\n*Hint*: For offering the selection, use Streamlit's [selectbox](https://docs.streamlit.io/develop/api-reference/widgets/st.selectbox) method.\n\n::: {.callout-caution collapse=\"true\" appearance=\"simple\" icon=\"false\"}\n#### Solution\n\n::: {#af0190d7 .cell execution_count=5}\n``` {.python .cell-code}\nimport streamlit as st\nimport pandas as pd\n\nst.title(\"Exam Scores\")\n\n\noptions = ['Made_Own_Study_Guide', 'Did_Exam_Prep Assignment', 'Studied_In_Groups']\n\nexams = pd.read_csv('https://raw.githubusercontent.com/mafudge/datasets/refs/heads/master/exam-scores/exam-scores.csv')\n\noption = st.selectbox('Select Exam:', options)\n\nsummary_df = exams.groupby(by=option).agg({'Class_Section': 'count', 'Student_Score' :'mean'})\nsummary_df = summary_df.rename(columns={'Class_Section': 'Student Count', 'Student_Score': 'Mean Score'})\n\nst.dataframe(summary_df)\n```\n:::\n\n\n:::\n::::\n\n\n## Pivot and Melt\n\nPivot and melt are inverse operations:\n\n- [pivot](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.pivot.html) makes \"long\" data \"wide\" moving rows into columns.\n- [melt](https://pandas.pydata.org/docs/reference/api/pandas.melt.html#pandas.melt]`df.melt) makes \"wide\" data \"long\" moving columns into rows. Basically, the opposite of `pivot`.\n\n\n::: {.callout-note}\n- These functions only move data, they are unable to summarize it.\n\n- The intersection of row/column must contain a single value. Multiple values under the same row/column will fail.\n:::\n\nTo set this up this example from `exams` let's create a dataframe that summarizes the data. We will add the index columns back to the dataframe for clarity. Please note this is not something that needs to be done typically. We are just re-using the dataset for this example. (In fact, the following block of code is basically creating a *pivot table* from the exams data. We'll see how to create pivot tables using a much simpler way below.)\n\n::: {#a6be0e0c .cell execution_count=6}\n``` {.python .cell-code}\n# Get average scores by section and exam version:\navg_scores_by_section_and_version = exams.groupby(\n    by=['Class_Section', 'Exam_Version']).agg({'Student_Score': 'mean'})\n\n# add section and exam version back to dataframe\navg_scores_by_section_and_version['Class_Section'] = avg_scores_by_section_and_version.index.get_level_values('Class_Section')\navg_scores_by_section_and_version['Exam_Version'] = avg_scores_by_section_and_version.index.get_level_values('Exam_Version')\n# reset the index\navg_scores_by_section_and_version = avg_scores_by_section_and_version.reset_index(drop=True)\n#rename the Student_score to average score\navg_scores_by_section_and_version =  avg_scores_by_section_and_version.rename(columns={'Student_Score': 'Average_Score'})\n#reorder the columns\navg_scores_by_section_and_version = avg_scores_by_section_and_version[['Class_Section', 'Exam_Version', 'Average_Score']]\n\n#show\navg_scores_by_section_and_version\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Class_Section</th>\n      <th>Exam_Version</th>\n      <th>Average_Score</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>M01</td>\n      <td>A</td>\n      <td>25.428571</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>M01</td>\n      <td>B</td>\n      <td>23.571429</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>M01</td>\n      <td>C</td>\n      <td>23.714286</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>M01</td>\n      <td>D</td>\n      <td>19.750000</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>M02</td>\n      <td>A</td>\n      <td>22.400000</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>M02</td>\n      <td>B</td>\n      <td>23.222222</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>M02</td>\n      <td>C</td>\n      <td>21.777778</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>M02</td>\n      <td>D</td>\n      <td>22.750000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Pivot()\n\nLet's pivot this data two different ways:\n\n- `exam_version_in_col`  - a pivot where the exam version is in the column\n- `class_section_in_col` - a pivot where the class section is in the column\n\n::: {#2e8cf48a .cell execution_count=7}\n``` {.python .cell-code}\nexam_version_in_col = avg_scores_by_section_and_version.pivot(\n    index='Class_Section', columns='Exam_Version', values='Average_Score')\nexam_version_in_col\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Exam_Version</th>\n      <th>A</th>\n      <th>B</th>\n      <th>C</th>\n      <th>D</th>\n    </tr>\n    <tr>\n      <th>Class_Section</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>M01</th>\n      <td>25.428571</td>\n      <td>23.571429</td>\n      <td>23.714286</td>\n      <td>19.75</td>\n    </tr>\n    <tr>\n      <th>M02</th>\n      <td>22.400000</td>\n      <td>23.222222</td>\n      <td>21.777778</td>\n      <td>22.75</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#6f515da3 .cell execution_count=8}\n``` {.python .cell-code}\nclass_section_in_col = avg_scores_by_section_and_version.pivot(\n    index='Exam_Version', columns='Class_Section', values='Average_Score')\nclass_section_in_col\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Class_Section</th>\n      <th>M01</th>\n      <th>M02</th>\n    </tr>\n    <tr>\n      <th>Exam_Version</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>A</th>\n      <td>25.428571</td>\n      <td>22.400000</td>\n    </tr>\n    <tr>\n      <th>B</th>\n      <td>23.571429</td>\n      <td>23.222222</td>\n    </tr>\n    <tr>\n      <th>C</th>\n      <td>23.714286</td>\n      <td>21.777778</td>\n    </tr>\n    <tr>\n      <th>D</th>\n      <td>19.750000</td>\n      <td>22.750000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Melt()\n\nWe will now melt the data back into its original shape. Melt requires:\n\n- `id_vars=list` list of columns which remain in the melt\n- `var_name=str` column name of the columns to unpivot \n- `value_name` column name of the values to unpivot\n\nFirst, to get this this example to work, we need to add the index values as a column (here called `Class_Section`):\n\n::: {#a6fcbfc4 .cell execution_count=9}\n``` {.python .cell-code}\nexam_version_in_col['Class_Section'] = exam_version_in_col.index\nmelted1 = exam_version_in_col.melt(id_vars=[\"Class_Section\"],\n                                   var_name=\"Exam_Version\",\n                                   value_name='Average_Score')\nmelted1\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Class_Section</th>\n      <th>Exam_Version</th>\n      <th>Average_Score</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>M01</td>\n      <td>A</td>\n      <td>25.428571</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>M02</td>\n      <td>A</td>\n      <td>22.400000</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>M01</td>\n      <td>B</td>\n      <td>23.571429</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>M02</td>\n      <td>B</td>\n      <td>23.222222</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>M01</td>\n      <td>C</td>\n      <td>23.714286</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>M02</td>\n      <td>C</td>\n      <td>21.777778</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>M01</td>\n      <td>D</td>\n      <td>19.750000</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>M02</td>\n      <td>D</td>\n      <td>22.750000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nDoing the same with the `class_section_in_col`:\n\n::: {#6d8e3a25 .cell execution_count=10}\n``` {.python .cell-code}\nclass_section_in_col['Exam_Version'] = class_section_in_col.index\nmelted2 = class_section_in_col.melt(id_vars=[\"Exam_Version\"],\n                                    var_name=\"Class_Section\",\n                                    value_name='Average_Score')\nmelted2\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Exam_Version</th>\n      <th>Class_Section</th>\n      <th>Average_Score</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>A</td>\n      <td>M01</td>\n      <td>25.428571</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>B</td>\n      <td>M01</td>\n      <td>23.571429</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>C</td>\n      <td>M01</td>\n      <td>23.714286</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>D</td>\n      <td>M01</td>\n      <td>19.750000</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>A</td>\n      <td>M02</td>\n      <td>22.400000</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>B</td>\n      <td>M02</td>\n      <td>23.222222</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>C</td>\n      <td>M02</td>\n      <td>21.777778</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>D</td>\n      <td>M02</td>\n      <td>22.750000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Pivot_table()\n\nThe `pd.pivot_table()` function combines a `groupby()` with a `pivot()`. Its intended for when you need to pivot and aggregate in the pivot, avoiding a lot of extra code such as adding indexes as columns (as we had to above).\n\nHere's the examples above, but with a pivot_table on the original `exams`data. We can skip the processing building `avg_scores_by_section_and_version` because `pivot_table()` allows us to summarize data.\n\n::: {#b91e1e12 .cell execution_count=11}\n``` {.python .cell-code}\nexam_version_in_col = exams.pivot_table(index='Class_Section',\n                                        columns='Exam_Version',\n                                        values='Student_Score',\n                                        aggfunc='mean')\nexam_version_in_col\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Exam_Version</th>\n      <th>A</th>\n      <th>B</th>\n      <th>C</th>\n      <th>D</th>\n    </tr>\n    <tr>\n      <th>Class_Section</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>M01</th>\n      <td>25.428571</td>\n      <td>23.571429</td>\n      <td>23.714286</td>\n      <td>19.75</td>\n    </tr>\n    <tr>\n      <th>M02</th>\n      <td>22.400000</td>\n      <td>23.222222</td>\n      <td>21.777778</td>\n      <td>22.75</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#2af5d544 .cell execution_count=12}\n``` {.python .cell-code}\nclass_section_in_col = exams.pivot_table(index='Exam_Version',\n                                         columns='Class_Section',\n                                         values='Student_Score',\n                                         aggfunc='mean')\nclass_section_in_col\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Class_Section</th>\n      <th>M01</th>\n      <th>M02</th>\n    </tr>\n    <tr>\n      <th>Exam_Version</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>A</th>\n      <td>25.428571</td>\n      <td>22.400000</td>\n    </tr>\n    <tr>\n      <th>B</th>\n      <td>23.571429</td>\n      <td>23.222222</td>\n    </tr>\n    <tr>\n      <th>C</th>\n      <td>23.714286</td>\n      <td>21.777778</td>\n    </tr>\n    <tr>\n      <th>D</th>\n      <td>19.750000</td>\n      <td>22.750000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::: {.callout-caution appearance=\"simple\" icon=\"false\"}\n### Code Challenge 6.2\n\nLet's build an interactive pivot table in streamlit! Using the exams csv file from above:\n\n1. Add a selection widget (use Steamlit's [selectbox](https://docs.streamlit.io/develop/api-reference/widgets/st.selectbox) method) that lets the user select one of the following fields to put in the row of the pivot table:\n\n\n    ::: {#c33fc35d .cell execution_count=13}\n    ``` {.python .cell-code}\n    fields = ['Class_Section', 'Exam_Version', 'Made_Own_Study_Guide', 'Did_Exam_Prep Assignment', 'Studied_In_Groups','Letter_Grade']\n    ```\n    :::\n    \n    \n1.  Add another selection widget that allows the user to select which field to display in the columns. *Note:* you will need to remove the field the user selected for the row in the list of options, else you'll get an error if they select the same field twice.\n\n1.  Create another selection widget that allows the user to select what data to populate the pivot table with. The pivot table should display the average of the selected value. The options for the displayed data should be:\n\n\n    ::: {#93b960cc .cell execution_count=14}\n    ``` {.python .cell-code}\n    measures = ['Completion_Time','Student_Score']\n    ```\n    :::\n    \n    \n1.  Build the pivot table dataframe from the inputs. Use the average for the `aggfunc`\n\n1.  Display the pivot table.\n\nHere's a screen shot of what your app should like:\n\n![](challenge-6_2-example.png)\n\n**Bonus:** Cache the exams data so that it is not reloaded every time you interact with the app! Refer back to the [Session State section of the Streamlit tutorial](https://su-ist356-m003-fall-2025.github.io/course-home/03_ui/ui-2.html#session-state-helping-streamlit-remember-values) for help.\n\n::: {.callout-caution collapse=\"true\" appearance=\"simple\" icon=\"false\"}\n#### Solution\n\n::: {#2d85132a .cell execution_count=15}\n``` {.python .cell-code}\nimport streamlit as st\nimport pandas as pd\n\nst.title(\"Exam Scores Pivot Table\")\n\n# load the data: we'll only do this once, then cache\nif 'exams' not in st.session_state:\n    st.session_state.exams = pd.read_csv('https://raw.githubusercontent.com/mafudge/datasets/refs/heads/master/exam-scores/exam-scores.csv')\n\n# set up the options\nfields = [ 'Class_Section', 'Exam_Version', 'Made_Own_Study_Guide', 'Did_Exam_Prep Assignment', 'Studied_In_Groups','Letter_Grade']\nmeasures = ['Student_Score', 'Completion_Time']\nrow = st.selectbox('Display in Row:', fields)\nfields.remove(row)\ncol = st.selectbox('Display in Column:', fields)\nvalue = st.selectbox('Display Average of:', measures)\n\npivot_df = st.session_state.exams.pivot_table(index=row, columns=col, values=value, aggfunc='mean')\nst.dataframe(pivot_df)\n```\n:::\n\n\n:::\n::::\n\n",
    "supporting": [
      "pandas-5_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}