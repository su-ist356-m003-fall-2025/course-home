{
  "hash": "cbf18ac5291638bb11b583c946d26dd0",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: '2. More Seaborn plots'\njupyter: python3\n---\n\nIn this tutorial we will cover some additional common plots.\n\n\n## Histograms\n\nA histogram is a graphical representation of the distribution of numerical data.\nIt is an estimate of the probability distribution of a continuous variable. In\nSeaborn we create a histogram using the [histplot](https://seaborn.pydata.org/generated/seaborn.histplot.html) function.\n\nTo illustrate its use, we'll use the [tips](https://rdrr.io/cran/reshape2/man/tips.html) data in Seaborn:\n\n::: {#845458a0 .cell execution_count=1}\n``` {.python .cell-code}\nimport seaborn as sns\ntips = sns.load_dataset('tips')\ntips.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>total_bill</th>\n      <th>tip</th>\n      <th>sex</th>\n      <th>smoker</th>\n      <th>day</th>\n      <th>time</th>\n      <th>size</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>16.99</td>\n      <td>1.01</td>\n      <td>Female</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>10.34</td>\n      <td>1.66</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>21.01</td>\n      <td>3.50</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>23.68</td>\n      <td>3.31</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>24.59</td>\n      <td>3.61</td>\n      <td>Female</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>4</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nThe data was collected by a waiter (in the 90s, I think) over several months. \n(Note that smoking was still allowed in restaurants when this data was taken. Ah, the 90s... I don't\nmiss everything about you.)\n\nLets make a histogram of the tip amounts:\n\n::: {#4a0b57fd .cell execution_count=2}\n``` {.python .cell-code}\nsns.histplot(data=tips, x='tip', bins=15)\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-3-output-1.png){width=585 height=429}\n:::\n:::\n\n\nThe y-axis is the number of tips in the given bin. The `bins` argument specifies\nthe number of bins to group the data into. We don't actually need to specify that\n(more on that below), but for now, we'll just use 15 as a good number.\n\nThe tip column is just the raw dollar amount of the tips. It'd be more interesting\nto see what the tip percentage is (i.e., the tip divided by the total bill).\nTo plot that, we'll first need to add a column of tip percentage to our data:\n\n::: {#e23e3bf4 .cell execution_count=3}\n``` {.python .cell-code}\ntips['tip_percentage'] = tips['tip'] / tips['total_bill'] * 100\ntips.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>total_bill</th>\n      <th>tip</th>\n      <th>sex</th>\n      <th>smoker</th>\n      <th>day</th>\n      <th>time</th>\n      <th>size</th>\n      <th>tip_percentage</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>16.99</td>\n      <td>1.01</td>\n      <td>Female</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>2</td>\n      <td>5.944673</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>10.34</td>\n      <td>1.66</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>3</td>\n      <td>16.054159</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>21.01</td>\n      <td>3.50</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>3</td>\n      <td>16.658734</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>23.68</td>\n      <td>3.31</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>2</td>\n      <td>13.978041</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>24.59</td>\n      <td>3.61</td>\n      <td>Female</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>4</td>\n      <td>14.680765</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nNow let's create a histogram of the tip percentage:\n\n::: {#13be093d .cell execution_count=4}\n``` {.python .cell-code}\nsns.histplot(data=tips, x='tip_percentage', bins=15)\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-5-output-1.png){width=585 height=429}\n:::\n:::\n\n\nWe see it's peaked around 15%, which was the standard tip amount at that time.\n\nThis is interesting, but we have additional data here. Let's see how tip percentage\nbreaks down by sex. As with the other plot commands, we accomplish that using the\n`hue` keyword argument:\n\n::: {#419c0b96 .cell execution_count=5}\n``` {.python .cell-code}\nsns.histplot(data=tips, x='tip_percentage', bins=15, hue='sex')\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-6-output-1.png){width=585 height=429}\n:::\n:::\n\n\nInteresting, but it's a little hard to compare the two histograms here since there\nare more males than females. What we actually want to plot on the y-axis is a probability\ndensity, or, to make it more understandable, a percent to indicate what fraction of\nmen and women tipped a given amount. We can convert the histogram from a count to a \ndensity using the `stat` command. There's several options it takes, but to get it \nto plot a percent, we set it to `percent`:\n\n::: {#e0e74ebe .cell execution_count=6}\n``` {.python .cell-code}\nsns.histplot(data=tips, x='tip_percentage', bins=15, hue='sex', stat='percent')\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-7-output-1.png){width=585 height=429}\n:::\n:::\n\n\nHmm, closer, but there still appears to be a larger percentage of males than females.\nThe reason is that the histograms are normalized together: i.e., the histogram heights\nare showing the percent of the *total population*, which includes both males and\nfemales. What we actually want is each histogram to be *normalized* separately, so\nthat the histogram heights show the percentage of men or women that tip a given amount.\nTo do that, we can add the `common_norm=False` argument:\n\n::: {#65aeb207 .cell execution_count=7}\n``` {.python .cell-code}\nsns.histplot(data=tips, x='tip_percentage', bins=15, hue='sex', stat='percent', common_norm=False)\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-8-output-1.png){width=585 height=429}\n:::\n:::\n\n\nNow we see something interesting: it looks like women tipped slightly better than men.\n\n### Bin widths\n\nOr did they? If we change the number of bins, it can change our impression of the data.\nFor example, if we reduce the bins to 8:\n\n::: {#82f2fc06 .cell execution_count=8}\n``` {.python .cell-code}\nsns.histplot(data=tips, x='tip_percentage', bins=8, hue='sex', stat='percent', common_norm=False)\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-9-output-1.png){width=585 height=429}\n:::\n:::\n\n\nThen, while it's clear a larger fraction of women tipped in the ~12-20% range, a larger fraction\nof men tipped inthe ~20-30% range. Using other bin numbers (try it!) can give other impressions.\n\nSo what's the appropriate number of bins to use? There are various \"rules\" out there to select\nthe right number. Seaborn (via numpy) has those rules coded up. In fact, you can pass a string\nto `bins` to invoke one of those rules instead of a number. The possiblities are documented\nin numpy's [histogram_bin_edges](https://numpy.org/doc/stable/reference/generated/numpy.histogram_bin_edges.html#numpy.histogram_bin_edges)\nfunction, which is what the bins argument calls. If you don't provide any bins argument,\nthe default (`'auto'`) will use a combination of rules to try to give a good estimate:\n\n::: {#7519efa4 .cell execution_count=9}\n``` {.python .cell-code}\nsns.histplot(data=tips, x='tip_percentage', hue='sex', stat='percent', common_norm=False)\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-10-output-1.png){width=585 height=429}\n:::\n:::\n\n\n## KDE plot\n\nChoosing the appropriate bin width is always a challenge when making histograms. An\nalternative is to instead use a [kernel density estimatation](https://en.wikipedia.org/wiki/Kernel_density_estimation)\n(KDE). A KDE is a method of interpolating the data to get a smooth curve. Basically,\na KDE sticks a little Gaussian distribution around each data point, then sums them\nup to get an overall distribution. Since there are no bins involved, it can provide\na more robust estimate of the distribution.\n\nYou can easily add a KDE to a histogram by turning on the ` kde=True` keyword argument:\n\n::: {#823f6283 .cell execution_count=10}\n``` {.python .cell-code}\nsns.histplot(data=tips, x='tip_percentage', hue='sex', stat='percent', bins=15, common_norm=False, kde=True)\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-11-output-1.png){width=585 height=429}\n:::\n:::\n\n\nThe lines plotted on top of the histogram show the KDE. Notice that they're smooth, and independent\nof the bins (try changing the number of bins; you'll get the same KDE plot).\n\nIf you want just a KDE plot on its own, you can use the [https://seaborn.pydata.org/generated/seaborn.kdeplot.html](kdeplot)\ncommand:\n\n::: {#5b319d0c .cell execution_count=11}\n``` {.python .cell-code}\nsns.kdeplot(data=tips, x='tip_percentage', hue='sex', common_norm=False)\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-12-output-1.png){width=597 height=429}\n:::\n:::\n\n\nThere are a couple things to be aware of with KDEs:\n\n1. KDEs have \"bandwidth\" parameter that determines how wide to make the little Guassians\n   that are added around each data point. This is like the bins in a histogram. Too \n   narrow a bandwidth will give too bumpy a distribution that obfuscates macro\n   trends, while too wide will give an over smoothed distribution that may hide \n   micro trends. You can adjust the bandwidth with additional\n   keyword arguments. Using the default is usually pretty good though. \n2. Due to their smoothing nature, KDEs tend to leak over hard boundaries. For example,\n   if you built a KDE of age distrubtions of children, you may get a tail to negative\n   numbers, which doesn't make sense.\n\n:::: {.callout-caution appearance=\"simple\" icon=\"false\"}\n### Code Challenge 2.1\n\nUse the Palmer penguins data to make a histogram of the  bill length of penguins,\nseparated by species. Plot density on the y-axis, turn on a KDE, and normalize\nthe distributions by species.\n\n::: {.callout-caution collapse=\"true\" appearance=\"simple\" icon=\"false\"}\n#### Solution\n\n::: {#bb9a0f89 .cell execution_count=12}\n``` {.python .cell-code}\npengo = sns.load_dataset(\"penguins\")\nsns.histplot(data=pengo, x='bill_length_mm', hue='species', stat='density', common_norm=False, kde=True)\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-13-output-1.png){width=597 height=429}\n:::\n:::\n\n\n:::\n::::\n\n## 2-D histograms\n\nOften we want to see counts or population density over two parameters. We can use `histplot` to make\n2D histograms. To do that, just pass in the extra dimension as a `y` arugment. For example,\nhere's a 2D histogram of the Palmer penguins flipper length versus bill length:\n\n::: {#f3a7d6cc .cell execution_count=13}\n``` {.python .cell-code}\nsns.histplot(data=pengo, x='bill_length_mm', y='flipper_length_mm')\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-14-output-1.png){width=593 height=429}\n:::\n:::\n\n\nHere, the darker the color, the larger the count. We can see exactly what color corresponds to what\ncount by turning on a colorbar with the `cbar` argument:\n\n::: {#5bf488c0 .cell execution_count=14}\n``` {.python .cell-code}\nsns.histplot(data=pengo, x='bill_length_mm', y='flipper_length_mm', cbar=True)\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-15-output-1.png){width=572 height=429}\n:::\n:::\n\n\n## Contour plots\n\nWe can also make 2D KDE plots using `kdeplot`; these are also known as *countour plots*.\n\nHere's a contour plot same Palmer penguins data as above:\n\n::: {#e7b4e4fd .cell execution_count=15}\n``` {.python .cell-code}\nsns.kdeplot(data=pengo, x='bill_length_mm', y='flipper_length_mm')\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-16-output-1.png){width=593 height=429}\n:::\n:::\n\n\nThe contours represent where the density is highest. It's easier to understand if you\nprovide the `levels` argument:\n\n::: {#cd24372b .cell execution_count=16}\n``` {.python .cell-code}\nsns.kdeplot(data=pengo, x='bill_length_mm', y='flipper_length_mm', levels=[0.1, 0.5])\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-17-output-1.png){width=593 height=429}\n:::\n:::\n\n\nThe outer contour corresponds to the 0.1 level, while the inner contour corresponds to the\n0.5 level.  The contours are centered on the highest density. This means that 90% of the\npopulation is within the 0.1 level, and 50% of the population is within the 0.5 level.\n\n\n## LM Plots\n\nA lmplot is a scatterplot with a linear regression line.\n\nLinear regression is a linear approach to modeling the relationship between a scalar\nresponse (or dependent variable) and one or more explanatory variables (or independent variables).\nThe case of one explanatory variable is called simple linear regression; for more than one,\nthe process is called multiple linear regression.\n\nTo illustrate, let's use the tips data to compare total bill to tip amount,\nseparated by the diner's sex:\n\n::: {#9621e412 .cell execution_count=17}\n``` {.python .cell-code}\nsns.lmplot(data=tips, x='total_bill', y='tip', hue='sex')\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-18-output-1.png){width=563 height=470}\n:::\n:::\n\n\n## Box Plots and Violin Plots\n\nA **box plot** is a method for graphically depicting groups of numerical data through their **quartiles**. The box extends from the Q1 to Q3 quartile values of the data, with a line at the median (Q2). The whiskers extend from the edges of the box to show the range of the data.  \n\n- They extend no more than 1.5 * IQR (Inter-quartile-range) (IQR = Q3 - Q1) from the edges of the box, ending at the farthest data point within that interval.\n- The line through the box is the median value of the data.\n- The box represents the interquartile range. Q3 - Q1\n- The whiskers represent the range of the data, defaults to 1.5 * (Q3 - Q1), a general rule for outliers.\n- Outliers are plotted as separate points.\n\nThink of a box plot as a must more detailed bar chart, since it tells you much more about the data than just totals.\n\nA **violin plot** is like the combination of a box plot and a histogram. It uses a kernel density estimate to show the probability density of the data at different values.\n\nWe'll use the tips data to illustrate them.\n\n::: {#ca4a8ed5 .cell execution_count=18}\n``` {.python .cell-code}\n# this will help us to see what the box plot and violin plot are showing us\ntips.describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>total_bill</th>\n      <th>tip</th>\n      <th>size</th>\n      <th>tip_percentage</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>count</th>\n      <td>244.000000</td>\n      <td>244.000000</td>\n      <td>244.000000</td>\n      <td>244.000000</td>\n    </tr>\n    <tr>\n      <th>mean</th>\n      <td>19.785943</td>\n      <td>2.998279</td>\n      <td>2.569672</td>\n      <td>16.080258</td>\n    </tr>\n    <tr>\n      <th>std</th>\n      <td>8.902412</td>\n      <td>1.383638</td>\n      <td>0.951100</td>\n      <td>6.107220</td>\n    </tr>\n    <tr>\n      <th>min</th>\n      <td>3.070000</td>\n      <td>1.000000</td>\n      <td>1.000000</td>\n      <td>3.563814</td>\n    </tr>\n    <tr>\n      <th>25%</th>\n      <td>13.347500</td>\n      <td>2.000000</td>\n      <td>2.000000</td>\n      <td>12.912736</td>\n    </tr>\n    <tr>\n      <th>50%</th>\n      <td>17.795000</td>\n      <td>2.900000</td>\n      <td>2.000000</td>\n      <td>15.476977</td>\n    </tr>\n    <tr>\n      <th>75%</th>\n      <td>24.127500</td>\n      <td>3.562500</td>\n      <td>3.000000</td>\n      <td>19.147549</td>\n    </tr>\n    <tr>\n      <th>max</th>\n      <td>50.810000</td>\n      <td>10.000000</td>\n      <td>6.000000</td>\n      <td>71.034483</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nHere's a box plot of total bill by day:\n\n::: {#3302d937 .cell execution_count=19}\n``` {.python .cell-code}\n# median = 17.79\n# 25% = 13.3475\n# 75% = 24.1275\nsns.boxplot(data=tips,y='total_bill')\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-20-output-1.png){width=585 height=393}\n:::\n:::\n\n\nHere's the equivalent violin plot:\n\n::: {#c6caf57b .cell execution_count=20}\n``` {.python .cell-code}\nsns.violinplot(data=tips,y='total_bill')\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-21-output-1.png){width=585 height=393}\n:::\n:::\n\n\nLet's create a boxplot of total bill by day and smoker:\n\n::: {#c47a3052 .cell execution_count=21}\n``` {.python .cell-code}\nsns.boxplot(data=tips, x='day', y='total_bill', hue=\"smoker\")\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-22-output-1.png){width=585 height=429}\n:::\n:::\n\n\nThe equivalent violin plot:\n\n::: {#87c58178 .cell execution_count=22}\n``` {.python .cell-code}\nsns.violinplot(data=tips, x='day', y='total_bill', hue=\"smoker\")\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-2_files/figure-html/cell-23-output-1.png){width=585 height=429}\n:::\n:::\n\n\n### Interpreting Box / Violin Plots\n\n- Short boxes and whiskers indicate that the data is dense concentrated near the median value. \n- Long whiskers and boxes indicate that the data is spread out.\n- Long whiskers and short boxes indicate that the data is spread out but concentrated near the median value.\n- Short whiskers and long boxes indicate that the data is concentrated but spread out.\n\n",
    "supporting": [
      "visualization-2_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}