{
  "hash": "810e78fb44be9a004480caee08d06942",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: '3. Sharing plots and Streamlit'\njupyter: python3\n---\n\nIn the previous tutorials we learned how to create plots and display them in\na Jupyter notebook. But how can we share them outside of a notebook?\n\nIn this tutorial we cover how to save plots so they can be shared/used in reports,\nand how to display them in a Streamlit app.\n\n## Saving figs: Matplotlib\n\nYou can save your plot as a file to disk using matplotlib's\n[savefig](https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.savefig.html) function.\nThe function takes as its first argument a string specifying the full path (including the\nfilename) of the file to create. Multiple file formats are supported (e.g.,\npng, jpeg, pdf, svg); png is most commonly used. The file format is inferred from the\nfile name extension. For example, if you save your figure to `plot.png`, the figure\nwill be saved as a png file.\n\nThe `savefig` function is actually a method of the `figure` object. As with creating plots,\nyou can save figures either via the explict object-oriented way (my preferred way)\nor via stateful execution.\n\n### Explicit object-oriented way\n\nLet's use our example from the [first visualization tutorial](visualization-1.qmd) of plotting\na sine wave:\n\n::: {#bffb2b75 .cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np\nfrom matplotlib import pyplot as plt\n# create the data\nx = np.linspace(0, 2*np.pi, 100)\ny = np.sin(x)\n# plot it\nfig = plt.figure()\nax = fig.add_subplot()\nax.plot(x, y)\nax.set_xlabel('x')\nax.set_ylabel('sin(x)')\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\nText(0, 0.5, 'sin(x)')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](visualization-3_files/figure-html/cell-2-output-2.png){width=608 height=429}\n:::\n:::\n\n\nNow to save it (here, as a png):\n\n::: {#bc52ddc2 .cell execution_count=2}\n``` {.python .cell-code}\nfig.savefig('sine.png')\n```\n:::\n\n\nThe savefig argument also takes other arugments. One of the most common to use is\n`dpi`. This sets the resolution of the plot. The default is based on your system\nsettings, but is typically 100 dots/inch. This can sometimes be too pixelated, especially\nif you are embedding the plot in a document that you wish to print. Set `dpi=300`\nfor typical publication-quailty pngs.\n\n### Stateful way\n\nThe same code above, but using stateful execution:\n\n::: {#7068b88c .cell execution_count=3}\n``` {.python .cell-code}\nimport numpy as np\nfrom matplotlib import pyplot as plt\n# create the data\nx = np.linspace(0, 2*np.pi, 100)\ny = np.sin(x)\n# plot it\nplt.plot(x, y)\nplt.xlabel('x')\nplt.ylabel('sin(x)')\n# save it\nplt.savefig('sine.png')\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-3_files/figure-html/cell-4-output-1.png){width=608 height=429}\n:::\n:::\n\n\n## Saving figs: Seaborn\n\nSeaborn, being built on top of matplotlib, just uses matplotlib's savefig method\nto save plots. To do that you can explicitly get the figure using the `get_figure()`\nmethod. This method can be called on the objects returned by a Seaborn plotting command\n(which are actually returning matplotlib Axes instances).\n\nRepeating our sine example, this time with Seaborn:\n\n::: {#d1297ef2 .cell execution_count=4}\n``` {.python .cell-code}\nimport seaborn as sns\n# plot the x and sin(x) (from above) using seaborn\nlp = sns.lineplot(x=x, y=y, label='sin(x)')\n\n# lp is actually a matplotlib axes instance. We can get the figure the axes\n# lives on with:\nfig = lp.get_figure()\n\n# now we can save it with\nfig.savefig('sine-seaborn.png')\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-3_files/figure-html/cell-5-output-1.png){width=590 height=411}\n:::\n:::\n\n\nNotice that we don't actually need to import matplotlib in this case.\n\nAlternatively, since Seaborn plots to the current figure, if we create\na figure first with matplotlib, Seaborn will plot to that. We can then save the\nfigure:\n\n::: {#ea6baf3f .cell execution_count=5}\n``` {.python .cell-code}\n# this works too\nfig = plt.figure()\nax = fig.add_subplot()\nlp = sns.lineplot(x=x, y=y, label='sin(x)')\nfig.savefig('sine-seaborn.png')\n```\n\n::: {.cell-output .cell-output-display}\n![](visualization-3_files/figure-html/cell-6-output-1.png){width=590 height=411}\n:::\n:::\n\n\nNote that in this case, we do need to import matplotlib in order to explicitly\ncreate the figure and axes.\n\n## Displaying figures in a Streamlit app\n\nYou can display a figure in a Streamlit app using Streamlit's \n[pyplot](https://docs.streamlit.io/develop/api-reference/charts/st.pyplot) function.\nThe pyplot method takes as input a matplotlib figure. Whether you are using matplotlib\nor Seaborn, you can get the figure by either explicitly creating it first with matplotlib,\nor using the `get_figure` method on the axes returned by a Seaborn plotting command.\nEither way, once you have the figure, you just pass it `st.pyplot`.\n\nHere's an example using Seaborn and the `get_figure` method:\n\n::: {#87a387b9 .cell execution_count=6}\n``` {.python .cell-code}\nimport seaborn as sns\nimport streamlit as st\n\n# let's make a scatter plot of the palmer penguins data\npengo = sns.load_dataset(\"penguins\")\npengo['count'] = 1\n\n#create a figure and series\nbp = sns.barplot(data=pengo, x=\"species\", y=\"count\", hue=\"species\", estimator=\"sum\")\n# add a title\nbp.set_title(\"Total Count by Species\")\n# get the figure\nfigure = bp.get_figure()\n# now display it\nst.pyplot(figure)\n```\n:::\n\n\n",
    "supporting": [
      "visualization-3_files"
    ],
    "filters": [],
    "includes": {}
  }
}