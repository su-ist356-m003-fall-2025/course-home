<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5. Basic data cleaning with Pandas – IST 356 Fall 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../04_data_wrangling/pandas-5.html" rel="next">
<link href="../04_data_wrangling/pandas-3.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-636770ed70550effe8cc9e61b03b729c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<meta property="og:title" content="5. Basic data cleaning with Pandas – IST 356 Fall 2025">
<meta property="og:description" content="">
<meta property="og:image" content="enter_gitHub_pages_URL_here/images/ischool_logo_reverseX2.png">
<meta property="og:site_name" content="IST 356 Fall 2025">
<meta property="og:image:height" content="105">
<meta property="og:image:width" content="650">
<meta name="twitter:title" content="5. Basic data cleaning with Pandas – IST 356 Fall 2025">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="enter_gitHub_pages_URL_here/images/ischool_logo_reverseX2.png">
<meta name="twitter:image-height" content="105">
<meta name="twitter:image-width" content="650">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">IST 356 Fall 2025</span>
    </a>
  </div>
          <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://ischool.syracuse.edu" target="_blank"> 
<span class="menu-text"><img src="../images/ischool_logo_reverseX2.png" height="30"></span></a>
  </li>  
</ul>
          <div class="quarto-navbar-tools">
</div>
            <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../04_data_wrangling/index.html">4. Data Wrangling</a></li><li class="breadcrumb-item"><a href="../04_data_wrangling/pandas-4.html">5. Basic data cleaning with Pandas</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00_intro/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction and computer setup</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../01_cli_conda/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Command line interface and Environments</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_cli_conda/shell-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Command Line Interface and the Unix Shell</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_cli_conda/conda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bash variables, environments, and <code>conda</code></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../02_python/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Python review</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_python/python-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Input, output, variables, types, conditionals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_python/python-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Iterations, lists, dictionaries, comprehensions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_python/python-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Functions, documentation, strings, files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_python/python-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Modules, import, pip, testing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../03_ui/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. UI</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_ui/ui-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Interaction in Jupyter using ipywidgets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_ui/ui-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Creating simple web apps with Streamlit</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../04_data_wrangling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_data_wrangling/numpy_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Introduction to NumPy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_data_wrangling/pandas-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Introduction to Pandas: Series and DataFrames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_data_wrangling/pandas-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Data I/O with Pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_data_wrangling/pandas-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Joining Multiple Pandas Dataframes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_data_wrangling/pandas-4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">5. Basic data cleaning with Pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_data_wrangling/pandas-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Grouping data and creating pivot tables with Pandas</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../05_web_apis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Web APIs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_web_apis/webapi-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. REST APIs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_web_apis/webapi-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Posting with REST API and caching results</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_web_apis/webapi-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Creating your own APIs with FastAPI</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../06_web_scraping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Web Scraping</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_web_scraping/scraping-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Introduction to Web Scraping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_web_scraping/scraping-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. More Scraping + actionability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_web_scraping/scraping-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Writing executable scripts with Argparse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_web_scraping/scraping-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Playwright + Argparse + Streamlit to create useful apps</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../07_visualization/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Visualization</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_visualization/visualization-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Introduction to Matplotlib and Seaborn</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_visualization/visualization-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. More Seaborn plots</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_final_project/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#apply" id="toc-apply" class="nav-link active" data-scroll-target="#apply">Apply</a>
  <ul class="collapse">
  <li><a href="#why-apply" id="toc-why-apply" class="nav-link" data-scroll-target="#why-apply">Why <code>apply</code>?</a></li>
  <li><a href="#cleaning-data-with-apply" id="toc-cleaning-data-with-apply" class="nav-link" data-scroll-target="#cleaning-data-with-apply">Cleaning data with <code>apply</code></a></li>
  </ul></li>
  <li><a href="#using-lambdas-to-apply-functions-to-multiple-columns" id="toc-using-lambdas-to-apply-functions-to-multiple-columns" class="nav-link" data-scroll-target="#using-lambdas-to-apply-functions-to-multiple-columns">Using <code>lambdas</code> to apply functions to multiple columns</a></li>
  <li><a href="#looping-over-dataframes" id="toc-looping-over-dataframes" class="nav-link" data-scroll-target="#looping-over-dataframes">Looping over Dataframes</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../04_data_wrangling/index.html">4. Data Wrangling</a></li><li class="breadcrumb-item"><a href="../04_data_wrangling/pandas-4.html">5. Basic data cleaning with Pandas</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">5. Basic data cleaning with Pandas</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this lesson we will start learning how to clean a dataframe data and loop over it. To follow along with the commands below, download the following scratch notebook to your <code>ist356</code> directory, then open it with VS Code:</p>
<p><a href="../assets/scratch-pandas-4.ipynb">Download scratch-pandas-4.ipynb</a></p>
<p>For this tutorial, we will be using some data representing a pretend restaurant’s transactions. The file is:</p>
<div id="a1fe3caf" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>checks_data <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/mafudge/datasets/refs/heads/master/dining/check-data.csv'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>(This link is provided in the scratch notebook.)</p>
<p>Let’s load the file with Pandas and sample a few of its rows to see what it contains:</p>
<div id="f2276789" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>checks <span class="op">=</span> pd.read_csv(checks_data)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>checks.sample(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">check</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">party size</th>
<th data-quarto-table-cell-role="th">total items on check</th>
<th data-quarto-table-cell-role="th">total amount of check</th>
<th data-quarto-table-cell-role="th">gratuity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>2705</td>
<td>2024-07-08</td>
<td>10</td>
<td>19</td>
<td>$838.85</td>
<td>$671.08</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>4031</td>
<td>2024-08-12</td>
<td>6</td>
<td>14</td>
<td>$655.48</td>
<td>$65.55</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>1066</td>
<td>2024-08-20</td>
<td>10</td>
<td>22</td>
<td>$485.76</td>
<td>$77.72</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>4590</td>
<td>2024-05-08</td>
<td>3</td>
<td>5</td>
<td>$220.40</td>
<td>$22.04</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">38</th>
<td>2341</td>
<td>2024-06-03</td>
<td>7</td>
<td>16</td>
<td>$1,118.88</td>
<td>$313.29</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">14</th>
<td>3676</td>
<td>2024-02-25</td>
<td>1</td>
<td>1</td>
<td>$19.89</td>
<td>$1.99</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">34</th>
<td>1368</td>
<td>2024-12-21</td>
<td>10</td>
<td>25</td>
<td>$2,193.00</td>
<td>$372.81</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">49</th>
<td>3404</td>
<td>2024-07-19</td>
<td>9</td>
<td>26</td>
<td>$2,382.90</td>
<td>$71.49</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">13</th>
<td>3867</td>
<td>2024-05-02</td>
<td>4</td>
<td>14</td>
<td>$499.10</td>
<td>$119.78</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">6</th>
<td>2527</td>
<td>2024-03-27</td>
<td>6</td>
<td>21</td>
<td>$921.48</td>
<td>$55.29</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s use the <code>info</code> method to get some more information about the columns:</p>
<div id="73bc0c53" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>checks.info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 50 entries, 0 to 49
Data columns (total 6 columns):
 #   Column                 Non-Null Count  Dtype 
---  ------                 --------------  ----- 
 0   check                  50 non-null     int64 
 1   date                   50 non-null     object
 2   party size             50 non-null     int64 
 3   total items on check   50 non-null     int64 
 4   total amount of check  50 non-null     object
 5   gratuity               50 non-null     object
dtypes: int64(3), object(3)
memory usage: 2.5+ KB</code></pre>
</div>
</div>
<p>There’s something odd here! Note that the data type of some of the columns (e.g., <code>total amount of check</code>) are <code>object</code> instead of <code>floats</code>, as you might expect. As we’ll see below, this is because of the <code>$</code> in the values; that will cause issues when we try to work with these columns. We’ll learn how to “clean” these columns so that we can do useful things with them.</p>
<section id="apply" class="level2">
<h2 class="anchored" data-anchor-id="apply">Apply</h2>
<p>The <code>apply</code> method allows us to execute a function over a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.apply.html">Series</a> or the entire <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.apply.html">DataFrame</a>.</p>
<p>The general syntax:</p>
<ul>
<li><p><code>Series.apply(func)</code> &lt;== call function <code>func</code> for every item in the Series.</p></li>
<li><p><code>DataFrame.apply(func, axis=1)</code> &lt;== call function <code>func</code> for every <em>row</em> in the DataFrame (<code>axis=1</code> =&gt; row).</p></li>
<li><p><code>DataFrame.apply(func, axis=0)</code> &lt;== call function <code>func</code> for every <em>column</em> in the DataFrame (<code>axis=0</code> =&gt; col).</p></li>
</ul>
<p>Note that the first argument <code>apply</code> is the function itself, not the function applied to some data. For example, suppose we define a function called <code>sq</code> that squares the input values:</p>
<div id="781a3380" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sq(x):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">**</span><span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>To apply this to one of the columns in our DataFrame (say, the <code>party size</code> column):</p>
<div id="607ab52d" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'party size'</span>].<span class="bu">apply</span>(sq)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>0      64
1       9
2      25
3       4
4      36
5       1
6      36
7      64
8     100
9       1
10     36
11    100
12     16
13     16
14      1
15     25
16     25
17      9
18     64
19      4
20     25
21      1
22     64
23      4
24    100
25     36
26     36
27      1
28     16
29      9
30    100
31      9
32      9
33     36
34    100
35     16
36      4
37     81
38     49
39     49
40      9
41     49
42     49
43     25
44     49
45     81
46      1
47      1
48     81
49     81
Name: party size, dtype: int64</code></pre>
</div>
</div>
<section id="why-apply" class="level3">
<h3 class="anchored" data-anchor-id="why-apply">Why <code>apply</code>?</h3>
<p>In the above example, you might wonder why we don’t just apply the function directly to the Series, rather than use <code>apply</code>. Afterall, in the <a href="../04_data_wrangling/pandas-1.html">first pandas tutorial</a> we learned that <code>Series</code> are vectorized just like numpy arrays. In other words, why not just do:</p>
<div id="d361a059" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sq(checks[<span class="st">'party size'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>0      64
1       9
2      25
3       4
4      36
5       1
6      36
7      64
8     100
9       1
10     36
11    100
12     16
13     16
14      1
15     25
16     25
17      9
18     64
19      4
20     25
21      1
22     64
23      4
24    100
25     36
26     36
27      1
28     16
29      9
30    100
31      9
32      9
33     36
34    100
35     16
36      4
37     81
38     49
39     49
40      9
41     49
42     49
43     25
44     49
45     81
46      1
47      1
48     81
49     81
Name: party size, dtype: int64</code></pre>
</div>
</div>
<p>In this case, you could just run the function on the series. Where <code>apply</code> is useful is when you have more complicated functions, in particular, ones that need to do different things depending on what the input data is. For example, suppose we define the following function to group parties into <code>small</code>, <code>medium</code>, and <code>large</code> depending on how many people are in the party:</p>
<div id="eadf6f55" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classify_size(x):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">4</span>:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'small'</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">&lt;</span> <span class="dv">8</span>:</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'medium'</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'large'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If we try to run this on the <code>party size</code> Series, we get an error:</p>
<div id="9b488f7a" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>classify_size(checks[<span class="st">'party size'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_11312/1113461677.py</span> in <span class="ansi-cyan-fg">?</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> classify_size(checks[<span class="ansi-yellow-fg">'party size'</span>])

<span class="ansi-green-fg">/tmp/ipykernel_11312/2519828553.py</span> in <span class="ansi-cyan-fg">?</span><span class="ansi-blue-fg">(x)</span>
<span class="ansi-green-fg">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> classify_size(x):
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> x &lt; <span class="ansi-green-fg">4</span>:
<span class="ansi-green-fg">      3</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-fg">'small'</span>
<span class="ansi-green-fg">      4</span>     <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> x &lt; <span class="ansi-green-fg">8</span>:
<span class="ansi-green-fg">      5</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-fg">'medium'</span>

<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/generic.py</span> in <span class="ansi-cyan-fg">?</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg">   1578</span>     @final
<span class="ansi-green-fg">   1579</span>     <span style="font-weight:bold;color:rgb(0,135,0)">def</span> __nonzero__(self) -&gt; NoReturn:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1580</span>         raise ValueError(
<span class="ansi-green-fg">   1581</span>             f"The truth value of a {type(self).__name__} is ambiguous. "
<span class="ansi-green-fg">   1582</span>             <span class="ansi-yellow-fg">"Use a.empty, a.bool(), a.item(), a.any() or a.all()."</span>
<span class="ansi-green-fg">   1583</span>         )

<span class="ansi-red-fg">ValueError</span>: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().</pre>
</div>
</div>
</div>
<p>This is because <code>if</code> statements cannot be vectorized like this. In contrast, the <code>apply</code> method <em>does</em> allow us to apply the function to the series:</p>
<div id="869827fd" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'party size'</span>].<span class="bu">apply</span>(classify_size)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0      large
1      small
2     medium
3      small
4     medium
5      small
6     medium
7      large
8      large
9      small
10    medium
11     large
12    medium
13    medium
14     small
15    medium
16    medium
17     small
18     large
19     small
20    medium
21     small
22     large
23     small
24     large
25    medium
26    medium
27     small
28    medium
29     small
30     large
31     small
32     small
33    medium
34     large
35    medium
36     small
37     large
38    medium
39    medium
40     small
41    medium
42    medium
43    medium
44    medium
45     large
46     small
47     small
48     large
49     large
Name: party size, dtype: object</code></pre>
</div>
</div>
<p>This is because the <code>apply</code> method takes care to cycle over every element in the series and apply the function.</p>
</section>
<section id="cleaning-data-with-apply" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-data-with-apply">Cleaning data with <code>apply</code></h3>
<p>The ability of <code>apply</code> to apply more complicated functions involving <code>if</code> statements makes it extremely useful for cleaning datasets. By “cleaning” we mean reformatting data and/or removing spurios values, so that we can use it without issue.</p>
<p>For example, say we want to add <code>price per item</code> to our DataFrame, defined as:</p>
<pre class="{text}"><code>price per item = total amount of check / total items on check</code></pre>
<p>The problem is <code>total amount of check</code> is an <code>object</code>, not a <code>float</code>. This means we cannot do math on it:</p>
<div id="3a16076f" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will raise a TypeError because of the dollar sign and commas!!!</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'price_per_item'</span>] <span class="op">=</span> checks[<span class="st">'total amount of check'</span>] <span class="op">/</span> checks[<span class="st">'total items on check'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/ops/array_ops.py:218</span>, in <span class="ansi-cyan-fg">_na_arithmetic_op</span><span class="ansi-blue-fg">(left, right, op, is_cmp)</span>
<span class="ansi-green-fg">    217</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">218</span>     result = <span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">left</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">right</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    219</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/computation/expressions.py:242</span>, in <span class="ansi-cyan-fg">evaluate</span><span class="ansi-blue-fg">(op, a, b, use_numexpr)</span>
<span class="ansi-green-fg">    240</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> use_numexpr:
<span class="ansi-green-fg">    241</span>         <span style="font-style:italic;color:rgb(95,135,135)"># error: "None" not callable</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">242</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">_evaluate</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">op</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">op_str</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">a</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">b</span><span class="ansi-yellow-bg">)</span>  <span style="font-style:italic;color:rgb(95,135,135)"># type: ignore[misc]</span>
<span class="ansi-green-fg">    243</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> _evaluate_standard(op, op_str, a, b)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/computation/expressions.py:73</span>, in <span class="ansi-cyan-fg">_evaluate_standard</span><span class="ansi-blue-fg">(op, op_str, a, b)</span>
<span class="ansi-green-fg">     72</span>     _store_test_result(<span style="font-weight:bold;color:rgb(0,135,0)">False</span>)
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">73</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">op</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">a</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">b</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-red-fg">TypeError</span>: unsupported operand type(s) for /: 'str' and 'int'

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[10]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="font-style:italic;color:rgb(95,135,135)"># This will raise a TypeError because of the dollar sign and commas!!!</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> checks[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">price_per_item</span><span class="ansi-yellow-fg">'</span>] = <span class="ansi-yellow-bg">checks</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">total amount of check</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">/</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">checks</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">total items on check</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/ops/common.py:76</span>, in <span class="ansi-cyan-fg">_unpack_zerodim_and_defer.&lt;locals&gt;.new_method</span><span class="ansi-blue-fg">(self, other)</span>
<span class="ansi-green-fg">     72</span>             <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">NotImplemented</span>
<span class="ansi-green-fg">     74</span> other = item_from_zerodim(other)
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">76</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">method</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">other</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/arraylike.py:210</span>, in <span class="ansi-cyan-fg">OpsMixin.__truediv__</span><span class="ansi-blue-fg">(self, other)</span>
<span class="ansi-green-fg">    208</span> <span style="color:rgb(175,0,255)">@unpack_zerodim_and_defer</span>(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">__truediv__</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">    209</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">__truediv__</span>(<span style="color:rgb(0,135,0)">self</span>, other):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">210</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_arith_method</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">other</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">operator</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">truediv</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/series.py:6154</span>, in <span class="ansi-cyan-fg">Series._arith_method</span><span class="ansi-blue-fg">(self, other, op)</span>
<span class="ansi-green-fg">   6152</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">_arith_method</span>(<span style="color:rgb(0,135,0)">self</span>, other, op):
<span class="ansi-green-fg">   6153</span>     <span style="color:rgb(0,135,0)">self</span>, other = <span style="color:rgb(0,135,0)">self</span>._align_for_op(other)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">6154</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">base</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">IndexOpsMixin</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_arith_method</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">other</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">op</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/base.py:1391</span>, in <span class="ansi-cyan-fg">IndexOpsMixin._arith_method</span><span class="ansi-blue-fg">(self, other, op)</span>
<span class="ansi-green-fg">   1388</span>     rvalues = np.arange(rvalues.start, rvalues.stop, rvalues.step)
<span class="ansi-green-fg">   1390</span> <span style="font-weight:bold;color:rgb(0,135,0)">with</span> np.errstate(<span style="color:rgb(0,135,0)">all</span>=<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">ignore</span><span class="ansi-yellow-fg">"</span>):
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1391</span>     result = <span class="ansi-yellow-bg">ops</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">arithmetic_op</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">lvalues</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">rvalues</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">op</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1393</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span>._construct_result(result, name=res_name)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/ops/array_ops.py:283</span>, in <span class="ansi-cyan-fg">arithmetic_op</span><span class="ansi-blue-fg">(left, right, op)</span>
<span class="ansi-green-fg">    279</span>     _bool_arith_check(op, left, right)  <span style="font-style:italic;color:rgb(95,135,135)"># type: ignore[arg-type]</span>
<span class="ansi-green-fg">    281</span>     <span style="font-style:italic;color:rgb(95,135,135)"># error: Argument 1 to "_na_arithmetic_op" has incompatible type</span>
<span class="ansi-green-fg">    282</span>     <span style="font-style:italic;color:rgb(95,135,135)"># "Union[ExtensionArray, ndarray[Any, Any]]"; expected "ndarray[Any, Any]"</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">283</span>     res_values = <span class="ansi-yellow-bg">_na_arithmetic_op</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">left</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">right</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">op</span><span class="ansi-yellow-bg">)</span>  <span style="font-style:italic;color:rgb(95,135,135)"># type: ignore[arg-type]</span>
<span class="ansi-green-fg">    285</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> res_values

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/ops/array_ops.py:227</span>, in <span class="ansi-cyan-fg">_na_arithmetic_op</span><span class="ansi-blue-fg">(left, right, op, is_cmp)</span>
<span class="ansi-green-fg">    219</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg">    220</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> is_cmp <span style="font-weight:bold;color:rgb(175,0,255)">and</span> (
<span class="ansi-green-fg">    221</span>         left.dtype == <span style="color:rgb(0,135,0)">object</span> <span style="font-weight:bold;color:rgb(175,0,255)">or</span> <span style="color:rgb(0,135,0)">getattr</span>(right, <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">dtype</span><span class="ansi-yellow-fg">"</span>, <span style="font-weight:bold;color:rgb(0,135,0)">None</span>) == <span style="color:rgb(0,135,0)">object</span>
<span class="ansi-green-fg">    222</span>     ):
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    225</span>         <span style="font-style:italic;color:rgb(95,135,135)"># Don't do this for comparisons, as that will handle complex numbers</span>
<span class="ansi-green-fg">    226</span>         <span style="font-style:italic;color:rgb(95,135,135)">#  incorrectly, see GH#32047</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">227</span>         result = <span class="ansi-yellow-bg">_masked_arith_op</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">left</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">right</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">op</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    228</span>     <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    229</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/ops/array_ops.py:163</span>, in <span class="ansi-cyan-fg">_masked_arith_op</span><span class="ansi-blue-fg">(x, y, op)</span>
<span class="ansi-green-fg">    161</span>     <span style="font-style:italic;color:rgb(95,135,135)"># See GH#5284, GH#5035, GH#19448 for historical reference</span>
<span class="ansi-green-fg">    162</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> mask.any():
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">163</span>         result[mask] = <span class="ansi-yellow-bg">op</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">xrav</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">mask</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">yrav</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">mask</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    165</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    166</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> is_scalar(y):

<span class="ansi-red-fg">TypeError</span>: unsupported operand type(s) for /: 'str' and 'int'</pre>
</div>
</div>
</div>
<p>How do we fix this? Let’s write a function to convert string values like this: <code>$4,590.45</code> into floats like this: <code>4590.45</code></p>
<div id="5c144cb3" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_currency(value:<span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">    This function will take a string value and remove the dollar sign and commas</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">    and return a float value.</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(value.replace(<span class="st">','</span>, <span class="st">''</span>).replace(<span class="st">'$'</span>, <span class="st">''</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tests</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> clean_currency(<span class="st">'$1,000.00'</span>) <span class="op">==</span> <span class="fl">1000.00</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> clean_currency(<span class="st">'$1,000'</span>) <span class="op">==</span> <span class="fl">1000.00</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> clean_currency(<span class="st">'1,000'</span>) <span class="op">==</span> <span class="fl">1000.00</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> clean_currency(<span class="st">'$1000'</span>) <span class="op">==</span> <span class="fl">1000.00</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>With our function written we can use <code>apply()</code> to transform the series:</p>
<div id="ae2d5e06" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'total_amount_of_check_cleaned'</span>] <span class="op">=</span> checks[<span class="st">'total amount of check'</span>].<span class="bu">apply</span>(clean_currency)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'price_per_item'</span>] <span class="op">=</span> checks[<span class="st">'total_amount_of_check_cleaned'</span>] <span class="op">/</span> checks[<span class="st">'total items on check'</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>checks.sample(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">check</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">party size</th>
<th data-quarto-table-cell-role="th">total items on check</th>
<th data-quarto-table-cell-role="th">total amount of check</th>
<th data-quarto-table-cell-role="th">gratuity</th>
<th data-quarto-table-cell-role="th">total_amount_of_check_cleaned</th>
<th data-quarto-table-cell-role="th">price_per_item</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>1336</td>
<td>2024-08-30</td>
<td>8</td>
<td>28</td>
<td>$1,199.80</td>
<td>$275.95</td>
<td>1199.80</td>
<td>42.85</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>2968</td>
<td>2024-12-28</td>
<td>1</td>
<td>3</td>
<td>$122.97</td>
<td>$23.36</td>
<td>122.97</td>
<td>40.99</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">49</th>
<td>3404</td>
<td>2024-07-19</td>
<td>9</td>
<td>26</td>
<td>$2,382.90</td>
<td>$71.49</td>
<td>2382.90</td>
<td>91.65</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>1564</td>
<td>2024-09-23</td>
<td>8</td>
<td>11</td>
<td>$928.40</td>
<td>$204.25</td>
<td>928.40</td>
<td>84.40</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">21</th>
<td>4440</td>
<td>2024-06-11</td>
<td>1</td>
<td>3</td>
<td>$168.96</td>
<td>$10.14</td>
<td>168.96</td>
<td>56.32</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0</th>
<td>2827</td>
<td>2024-05-06</td>
<td>8</td>
<td>12</td>
<td>$415.08</td>
<td>$107.92</td>
<td>415.08</td>
<td>34.59</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">44</th>
<td>2053</td>
<td>2024-12-14</td>
<td>7</td>
<td>23</td>
<td>$588.11</td>
<td>$164.67</td>
<td>588.11</td>
<td>25.57</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>3795</td>
<td>2024-02-21</td>
<td>3</td>
<td>7</td>
<td>$212.38</td>
<td>$46.72</td>
<td>212.38</td>
<td>30.34</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3685</td>
<td>2024-12-07</td>
<td>5</td>
<td>5</td>
<td>$252.95</td>
<td>$50.59</td>
<td>252.95</td>
<td>50.59</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>1194</td>
<td>2024-07-06</td>
<td>2</td>
<td>6</td>
<td>$453.06</td>
<td>$72.49</td>
<td>453.06</td>
<td>75.51</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember its a really good idea to <strong>track lineage</strong> when you are building a data pipeline.</p>
<p><strong>NEVER</strong> replace columns, always create new ones.</p>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Code Challenge 5.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s take what we did so far, and create a dataset that would be better prepared for analysis / machine learning. We’ll display it in a Streamlit app.</p>
<ol type="1">
<li><p>Create a script called <code>st-cleaned_checks.py</code>.</p></li>
<li><p>Add your <code>clean_currency</code> function to the script.</p></li>
<li><p>Load the checks dataset into a Pandas <code>DataFrame</code> and:</p>
<ul>
<li>Clean the <code>total amount of check</code> and <code>gratuity</code> columns.</li>
<li>Calculate the <code>price_per_item</code> as total amount of check / total items on check.</li>
<li>Calcualte the <code>price_per_person</code> as total amont of check / party size.</li>
<li>Calcualte the <code>items_per_person</code> as total items on check / party size.</li>
<li>Calcualte the <code>tip_percentage</code> as the total amount of check / gratuity.</li>
</ul></li>
<li><p>Display the cleaned DataFrame along with a description of its data (i.e., display the output of <code>describe</code>) in a Streamlit app.</p></li>
<li><p>Test that your app works by running it.</p></li>
</ol>
<div class="callout callout-style-simple callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>The <code>st-cleaned_checks.py</code> script:</li>
</ol>
<div id="aa3693f5" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit <span class="im">as</span> st</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_currency(value:<span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">    This function will take a string value and remove the dollar sign and commas</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">    and return a float value.</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(value.replace(<span class="st">','</span>, <span class="st">''</span>).replace(<span class="st">'$'</span>, <span class="st">''</span>))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>st.title(<span class="st">"Dining Check Data"</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># load</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>checks <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/mafudge/datasets/refs/heads/master/dining/check-data.csv'</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co"># transformations</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'total_amount_of_check_cleaned'</span>] <span class="op">=</span> checks[<span class="st">'total amount of check'</span>].<span class="bu">apply</span>(clean_currency)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'gratuity_cleaned'</span>] <span class="op">=</span> checks[<span class="st">'gratuity'</span>].<span class="bu">apply</span>(clean_currency)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'price_per_item'</span>] <span class="op">=</span> checks[<span class="st">'total_amount_of_check_cleaned'</span>] <span class="op">/</span> checks[<span class="st">'total items on check'</span>]</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'price_per_person'</span>] <span class="op">=</span> checks[<span class="st">'total_amount_of_check_cleaned'</span>] <span class="op">/</span> checks[<span class="st">'party size'</span>]</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'items_per_person'</span>] <span class="op">=</span> checks[<span class="st">'total items on check'</span>] <span class="op">/</span> checks[<span class="st">'party size'</span>]</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'tip_percentage'</span>] <span class="op">=</span> checks[<span class="st">'gratuity_cleaned'</span>] <span class="op">/</span> checks[<span class="st">'total_amount_of_check_cleaned'</span>]</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>st.dataframe(checks, width<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>st.header(<span class="st">"Summary:"</span>)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>st.dataframe(checks.describe())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ol start="2" type="1">
<li>Test it by running the following in the terminal (make sure to activate your conda environment first):</li>
</ol>
<pre class="{bash}"><code>python -m streamlit run st-cleaned_checks.py</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="using-lambdas-to-apply-functions-to-multiple-columns" class="level2">
<h2 class="anchored" data-anchor-id="using-lambdas-to-apply-functions-to-multiple-columns">Using <code>lambdas</code> to apply functions to multiple columns</h2>
<p>So far we’ve used <code>apply</code> with functions that take in a single Series. What do we do if we need a function to operate on multiple columns in a <code>DataFrame</code>? For that, we can use Python <a href="https://docs.python.org/3/tutorial/controlflow.html#lambda-expressions">lambda</a> functions.</p>
<p>An example using our checks data:</p>
<p>Marketing wants you to build some <em>key performance indicators</em> (KPIs) using the checks data. A KPI is a statistic that summarizes some larger data set, so the data can be more easily tracked over time. For example a letter grade such as an A- is a KPI summary of all your graded efforts to date.</p>
<p>In this example, marketing wants you to build two KPIs:</p>
<p><strong>KPI 1: Whales</strong></p>
<p>Marketing has decided to group customers into the following categories: - <code>big eaters</code>: Customers who are in the top 25% (i.e., above the 0.75 <em>quantile</em>) for items per person. - <code>big spenders</code>: Customers who are in the top 25% for price per person. - <code>whale</code>: Customers who are in the top 25% for both items per person <em>and</em> price per person.</p>
<p><strong>KPI 2: Tippers</strong></p>
<p>Marketing has decided to further group customers into the following categories based on their tipping: - <code>light</code>: Customers who are in the botton 25% (i.e., below the 0.25 quantile) by tip percentage. - <code>heavy</code>: Customers who are in the top 25% (i.e., above the 0.75 quantile) by tip percentage.</p>
<p>To calculate percentiles we will use the <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.quantile.html">quantile</a> Series method in Pandas. This returns the value at which X% of the data is below the given percentile.</p>
<p>Before we can apply our KPI’s we must write the functions!</p>
<div id="ba68181e" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'gratuity_cleaned'</span>] <span class="op">=</span> checks[<span class="st">'gratuity'</span>].<span class="bu">apply</span>(clean_currency)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'price_per_item'</span>] <span class="op">=</span> checks[<span class="st">'total_amount_of_check_cleaned'</span>] <span class="op">/</span> checks[<span class="st">'total items on check'</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'price_per_person'</span>] <span class="op">=</span> checks[<span class="st">'total_amount_of_check_cleaned'</span>] <span class="op">/</span> checks[<span class="st">'party size'</span>]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'items_per_person'</span>] <span class="op">=</span> checks[<span class="st">'total items on check'</span>] <span class="op">/</span> checks[<span class="st">'party size'</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'tip_percentage'</span>] <span class="op">=</span> checks[<span class="st">'gratuity_cleaned'</span>] <span class="op">/</span> checks[<span class="st">'total_amount_of_check_cleaned'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>To categorize whales:</p>
<div id="cd0ed02f" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> detect_whale(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>        items_per_person:<span class="bu">float</span>, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        price_per_person:<span class="bu">float</span>, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        items_per_person_75th_pctile:<span class="bu">float</span>, </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        price_per_person_75_pctile:<span class="bu">float</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> items_per_person <span class="op">&gt;</span> items_per_person_75th_pctile <span class="kw">and</span> price_per_person <span class="op">&gt;</span> price_per_person_75_pctile:</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'whale'</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> items_per_person <span class="op">&gt;</span> items_per_person_75th_pctile:</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'big eater'</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> price_per_person <span class="op">&gt;</span> price_per_person_75_pctile:</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'big spender'</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">''</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s test our function using the <code>quantile</code> method:</p>
<div id="678f2372" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tests</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ppp_75 <span class="op">=</span> checks[<span class="st">'price_per_person'</span>].quantile(<span class="fl">0.75</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ipp_75 <span class="op">=</span> checks[<span class="st">'items_per_person'</span>].quantile(<span class="fl">0.75</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ppp_75, ipp_75)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> detect_whale(<span class="dv">5</span>, <span class="dv">250</span>, <span class="dv">3</span>, <span class="dv">175</span>) <span class="op">==</span> <span class="st">'whale'</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> detect_whale(<span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">3</span>, <span class="dv">175</span>) <span class="op">==</span> <span class="st">'big eater'</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> detect_whale(<span class="dv">1</span>, <span class="dv">250</span>, <span class="dv">3</span>, <span class="dv">175</span>) <span class="op">==</span> <span class="st">'big spender'</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> detect_whale(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">3</span>, <span class="dv">175</span>) <span class="op">==</span> <span class="st">''</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>158.35666666666668 3.0</code></pre>
</div>
</div>
<p>Now we want to apply the <code>detect_whale</code> function to the <code>checks</code> DataFrame. But <code>detect_whale</code> requires two columns as input, the <code>items_per_person</code> and <code>price_per_person</code>. How do we do that?</p>
<p>We can use a <code>lambda</code> function to quickly define a small function that will return the required columns when provided a row. In general, the syntax for a <code>lambda</code> function is <code>lambda ARGS: FUNC</code>. For example, <code>lambda a, b: a+b</code> will return the sum of the two arguments its given.</p>
<p>In our case, we can use a <code>lambda</code> function to pull out the needed columns and give them to <code>apply</code>, like so:</p>
<div id="f1c3f99c" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'whale'</span>] <span class="op">=</span> checks.<span class="bu">apply</span>(<span class="kw">lambda</span> row: detect_whale(row[<span class="st">'items_per_person'</span>], row[<span class="st">'price_per_person'</span>], ipp_75, ppp_75), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>checks.sample(<span class="dv">25</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">check</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">party size</th>
<th data-quarto-table-cell-role="th">total items on check</th>
<th data-quarto-table-cell-role="th">total amount of check</th>
<th data-quarto-table-cell-role="th">gratuity</th>
<th data-quarto-table-cell-role="th">total_amount_of_check_cleaned</th>
<th data-quarto-table-cell-role="th">price_per_item</th>
<th data-quarto-table-cell-role="th">gratuity_cleaned</th>
<th data-quarto-table-cell-role="th">price_per_person</th>
<th data-quarto-table-cell-role="th">items_per_person</th>
<th data-quarto-table-cell-role="th">tip_percentage</th>
<th data-quarto-table-cell-role="th">whale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">31</th>
<td>1945</td>
<td>2024-02-05</td>
<td>3</td>
<td>7</td>
<td>$132.86</td>
<td>$21.26</td>
<td>132.86</td>
<td>18.98</td>
<td>21.26</td>
<td>44.286667</td>
<td>2.333333</td>
<td>0.160018</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">28</th>
<td>2446</td>
<td>2024-12-15</td>
<td>4</td>
<td>12</td>
<td>$575.64</td>
<td>$28.78</td>
<td>575.64</td>
<td>47.97</td>
<td>28.78</td>
<td>143.910000</td>
<td>3.000000</td>
<td>0.049997</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">25</th>
<td>4031</td>
<td>2024-08-12</td>
<td>6</td>
<td>14</td>
<td>$655.48</td>
<td>$65.55</td>
<td>655.48</td>
<td>46.82</td>
<td>65.55</td>
<td>109.246667</td>
<td>2.333333</td>
<td>0.100003</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>3867</td>
<td>2024-05-02</td>
<td>4</td>
<td>14</td>
<td>$499.10</td>
<td>$119.78</td>
<td>499.10</td>
<td>35.65</td>
<td>119.78</td>
<td>124.775000</td>
<td>3.500000</td>
<td>0.239992</td>
<td>big eater</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">9</th>
<td>2968</td>
<td>2024-12-28</td>
<td>1</td>
<td>3</td>
<td>$122.97</td>
<td>$23.36</td>
<td>122.97</td>
<td>40.99</td>
<td>23.36</td>
<td>122.970000</td>
<td>3.000000</td>
<td>0.189965</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">42</th>
<td>1361</td>
<td>2024-11-21</td>
<td>7</td>
<td>14</td>
<td>$65.80</td>
<td>$16.45</td>
<td>65.80</td>
<td>4.70</td>
<td>16.45</td>
<td>9.400000</td>
<td>2.000000</td>
<td>0.250000</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">3</th>
<td>1957</td>
<td>2024-02-15</td>
<td>2</td>
<td>2</td>
<td>$42.44</td>
<td>$8.91</td>
<td>42.44</td>
<td>21.22</td>
<td>8.91</td>
<td>21.220000</td>
<td>1.000000</td>
<td>0.209943</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">38</th>
<td>2341</td>
<td>2024-06-03</td>
<td>7</td>
<td>16</td>
<td>$1,118.88</td>
<td>$313.29</td>
<td>1118.88</td>
<td>69.93</td>
<td>313.29</td>
<td>159.840000</td>
<td>2.285714</td>
<td>0.280003</td>
<td>big spender</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">33</th>
<td>3842</td>
<td>2024-03-31</td>
<td>6</td>
<td>6</td>
<td>$147.12</td>
<td>$5.88</td>
<td>147.12</td>
<td>24.52</td>
<td>5.88</td>
<td>24.520000</td>
<td>1.000000</td>
<td>0.039967</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">16</th>
<td>3694</td>
<td>2024-11-03</td>
<td>5</td>
<td>17</td>
<td>$1,574.37</td>
<td>$173.18</td>
<td>1574.37</td>
<td>92.61</td>
<td>173.18</td>
<td>314.874000</td>
<td>3.400000</td>
<td>0.110000</td>
<td>whale</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">19</th>
<td>3718</td>
<td>2024-10-30</td>
<td>2</td>
<td>5</td>
<td>$464.70</td>
<td>$120.82</td>
<td>464.70</td>
<td>92.94</td>
<td>120.82</td>
<td>232.350000</td>
<td>2.500000</td>
<td>0.259996</td>
<td>big spender</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">46</th>
<td>3621</td>
<td>2024-06-23</td>
<td>1</td>
<td>2</td>
<td>$138.76</td>
<td>$19.43</td>
<td>138.76</td>
<td>69.38</td>
<td>19.43</td>
<td>138.760000</td>
<td>2.000000</td>
<td>0.140026</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5</th>
<td>2191</td>
<td>2024-01-06</td>
<td>1</td>
<td>3</td>
<td>$17.85</td>
<td>$1.96</td>
<td>17.85</td>
<td>5.95</td>
<td>1.96</td>
<td>17.850000</td>
<td>3.000000</td>
<td>0.109804</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">43</th>
<td>1186</td>
<td>2024-09-21</td>
<td>5</td>
<td>16</td>
<td>$298.72</td>
<td>$74.68</td>
<td>298.72</td>
<td>18.67</td>
<td>74.68</td>
<td>59.744000</td>
<td>3.200000</td>
<td>0.250000</td>
<td>big eater</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">35</th>
<td>2486</td>
<td>2024-01-27</td>
<td>4</td>
<td>13</td>
<td>$569.01</td>
<td>$108.11</td>
<td>569.01</td>
<td>43.77</td>
<td>108.11</td>
<td>142.252500</td>
<td>3.250000</td>
<td>0.189997</td>
<td>big eater</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>2386</td>
<td>2024-03-31</td>
<td>5</td>
<td>12</td>
<td>$1,147.80</td>
<td>$137.74</td>
<td>1147.80</td>
<td>95.65</td>
<td>137.74</td>
<td>229.560000</td>
<td>2.400000</td>
<td>0.120003</td>
<td>big spender</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1</th>
<td>2443</td>
<td>2024-06-09</td>
<td>3</td>
<td>10</td>
<td>$286.40</td>
<td>$31.50</td>
<td>286.40</td>
<td>28.64</td>
<td>31.50</td>
<td>95.466667</td>
<td>3.333333</td>
<td>0.109986</td>
<td>big eater</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">34</th>
<td>1368</td>
<td>2024-12-21</td>
<td>10</td>
<td>25</td>
<td>$2,193.00</td>
<td>$372.81</td>
<td>2193.00</td>
<td>87.72</td>
<td>372.81</td>
<td>219.300000</td>
<td>2.500000</td>
<td>0.170000</td>
<td>big spender</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>2809</td>
<td>2024-12-30</td>
<td>6</td>
<td>6</td>
<td>$104.46</td>
<td>$1.04</td>
<td>104.46</td>
<td>17.41</td>
<td>1.04</td>
<td>17.410000</td>
<td>1.000000</td>
<td>0.009956</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">32</th>
<td>1440</td>
<td>2024-11-30</td>
<td>3</td>
<td>8</td>
<td>$589.04</td>
<td>$141.37</td>
<td>589.04</td>
<td>73.63</td>
<td>141.37</td>
<td>196.346667</td>
<td>2.666667</td>
<td>0.240001</td>
<td>big spender</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">29</th>
<td>4590</td>
<td>2024-05-08</td>
<td>3</td>
<td>5</td>
<td>$220.40</td>
<td>$22.04</td>
<td>220.40</td>
<td>44.08</td>
<td>22.04</td>
<td>73.466667</td>
<td>1.666667</td>
<td>0.100000</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">22</th>
<td>1336</td>
<td>2024-08-30</td>
<td>8</td>
<td>28</td>
<td>$1,199.80</td>
<td>$275.95</td>
<td>1199.80</td>
<td>42.85</td>
<td>275.95</td>
<td>149.975000</td>
<td>3.500000</td>
<td>0.229997</td>
<td>big eater</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">48</th>
<td>4161</td>
<td>2024-06-22</td>
<td>9</td>
<td>28</td>
<td>$1,385.16</td>
<td>$235.48</td>
<td>1385.16</td>
<td>49.47</td>
<td>235.48</td>
<td>153.906667</td>
<td>3.111111</td>
<td>0.170002</td>
<td>big eater</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">20</th>
<td>3393</td>
<td>2024-08-26</td>
<td>5</td>
<td>6</td>
<td>$302.64</td>
<td>$24.21</td>
<td>302.64</td>
<td>50.44</td>
<td>24.21</td>
<td>60.528000</td>
<td>1.200000</td>
<td>0.079996</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>3676</td>
<td>2024-02-25</td>
<td>1</td>
<td>1</td>
<td>$19.89</td>
<td>$1.99</td>
<td>19.89</td>
<td>19.89</td>
<td>1.99</td>
<td>19.890000</td>
<td>1.000000</td>
<td>0.100050</td>
<td></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Code Challenge 5.2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s build on the Streamlit app you made in Challenge 5.1, and add our KPIs to it.</p>
<ol type="1">
<li><p>Copy <code>st-cleaned_checks.py</code> to a new file called <code>st-checks_kpi.py</code>.</p></li>
<li><p>Add the <code>detect_whale</code> function defined above to <code>st-checks_kpi.py</code>.</p></li>
<li><p>Write a new function <code>detect_tipper(tip_pct, tip_pcy_75th_pctile, tip_pct_25_pctile)</code> that should return either “light” or “heavy” depending on whether the tip is below the 0.25 quantile or above the 0.75 quantile, respectively. If neither, the function should just return an empty string.</p></li>
<li><p>Apply the <code>detect_whale</code> and <code>detect_tipper</code> functions to the DataFrame, storing the results in new columns called <code>whale</code> and <code>tipper</code>, respectively.</p></li>
<li><p>As with before, diplay the modified DataFrame and the output of <code>describe</code> in a Streamlit app.</p></li>
</ol>
<div class="callout callout-style-simple callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>It’s easiest to do the copy using the command line. In the terminal, run:</li>
</ol>
<pre class="{bash}"><code>cp st-cleaned_checks.py st-checks_kpi.py</code></pre>
<ol type="1">
<li>Now modify <code>st-checks_kpi.py</code>. It should look like:</li>
</ol>
<div id="79e72122" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit <span class="im">as</span> st</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_currency(value:<span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">    This function will take a string value and remove the dollar sign and commas</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">    and return a float value.</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(value.replace(<span class="st">','</span>, <span class="st">''</span>).replace(<span class="st">'$'</span>, <span class="st">''</span>))</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> detect_whale(</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        items_per_person:<span class="bu">float</span>, </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        price_per_person:<span class="bu">float</span>, </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        items_per_person_75th_pctile:<span class="bu">float</span>, </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        price_per_person_75_pctile:<span class="bu">float</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> items_per_person <span class="op">&gt;</span> items_per_person_75th_pctile <span class="kw">and</span> price_per_person <span class="op">&gt;</span> price_per_person_75_pctile:</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'whale'</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> items_per_person <span class="op">&gt;</span> items_per_person_75th_pctile:</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'big eater'</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> price_per_person <span class="op">&gt;</span> price_per_person_75_pctile:</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'big spender'</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">''</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> detect_tipper(tip_pct:<span class="bu">float</span>, tip_pct_75th_pctile:<span class="bu">float</span>, tip_pct_25th_pctile:<span class="bu">float</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tip_pct <span class="op">&gt;</span> tip_pct_75th_pctile:</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'heavy tipper'</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tip_pct <span class="op">&lt;</span> tip_pct_25th_pctile:</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'light tipper'</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">''</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>st.title(<span class="st">"Dining Check Data"</span>)</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="co"># load</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>checks <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/mafudge/datasets/refs/heads/master/dining/check-data.csv'</span>)</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="co"># transformations</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'total_amount_of_check_cleaned'</span>] <span class="op">=</span> checks[<span class="st">'total amount of check'</span>].<span class="bu">apply</span>(clean_currency)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'gratuity_cleaned'</span>] <span class="op">=</span> checks[<span class="st">'gratuity'</span>].<span class="bu">apply</span>(clean_currency)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'price_per_item'</span>] <span class="op">=</span> checks[<span class="st">'total_amount_of_check_cleaned'</span>] <span class="op">/</span> checks[<span class="st">'total items on check'</span>]</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'price_per_person'</span>] <span class="op">=</span> checks[<span class="st">'total_amount_of_check_cleaned'</span>] <span class="op">/</span> checks[<span class="st">'party size'</span>]</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'items_per_person'</span>] <span class="op">=</span> checks[<span class="st">'total items on check'</span>] <span class="op">/</span> checks[<span class="st">'party size'</span>]</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'tip_percentage'</span>] <span class="op">=</span> checks[<span class="st">'gratuity_cleaned'</span>] <span class="op">/</span> checks[<span class="st">'total_amount_of_check_cleaned'</span>]</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="co">## The new stuff adding KPIs:</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="co"># get KPI boundaries</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>ppp_75 <span class="op">=</span> checks[<span class="st">'price_per_person'</span>].quantile(<span class="fl">0.75</span>)</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>ipp_75 <span class="op">=</span> checks[<span class="st">'items_per_person'</span>].quantile(<span class="fl">0.75</span>)</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>tp_75 <span class="op">=</span> checks[<span class="st">'tip_percentage'</span>].quantile(<span class="fl">0.75</span>)</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>tp_25 <span class="op">=</span> checks[<span class="st">'tip_percentage'</span>].quantile(<span class="fl">0.25</span>)</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcualte KPI's</span></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'whale'</span>] <span class="op">=</span> checks.<span class="bu">apply</span>(<span class="kw">lambda</span> row: detect_whale(row[<span class="st">'items_per_person'</span>], row[<span class="st">'price_per_person'</span>], ipp_75, ppp_75), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>checks[<span class="st">'tipper'</span>] <span class="op">=</span> checks.<span class="bu">apply</span>(<span class="kw">lambda</span> row: detect_tipper(row[<span class="st">'tip_percentage'</span>], tp_75, tp_25), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Now display</span></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>st.dataframe(checks, width<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>st.header(<span class="st">"Summary:"</span>)</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>st.dataframe(checks.describe())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="looping-over-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="looping-over-dataframes">Looping over Dataframes</h2>
<p>If you must run a <code>for</code> loop over your DataFrames, there are two choices:</p>
<ul>
<li><code>df.iterrows()</code> dict-like iteration</li>
<li><code>df.itertuples()</code> named-tuple like iteration (faster)</li>
</ul>
<p>Let’s do an example where we display the check number, whale and tipper for “heavy tipper” checks.</p>
<div id="9f1e6f5e" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Using the iterrows() method</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Total Amount of Whale Checks"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,row <span class="kw">in</span> checks.iterrows():</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'whale'</span>] <span class="op">==</span> <span class="st">'whale'</span>:</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i, row[<span class="st">'check'</span>], row[<span class="st">'total_amount_of_check_cleaned'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="c4f70d34" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same example with the itertuples() method</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Total Amount of Whale Checks"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> checks.itertuples():</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row.whale <span class="op">==</span> <span class="st">'whale'</span>:</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row.check, row.total_amount_of_check_cleaned)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="239bb416" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Of course you don't need a loop to do this:</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>checks[checks[<span class="st">'whale'</span>] <span class="op">==</span> <span class="st">'whale'</span>][[<span class="st">'check'</span>, <span class="st">'total_amount_of_check_cleaned'</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("enter_gitHub_pages_URL_here");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../04_data_wrangling/pandas-3.html" class="pagination-link" aria-label="4. Joining Multiple Pandas Dataframes">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">4. Joining Multiple Pandas Dataframes</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../04_data_wrangling/pandas-5.html" class="pagination-link" aria-label="6. Grouping data and creating pivot tables with Pandas">
        <span class="nav-page-text">6. Grouping data and creating pivot tables with Pandas</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Adapted from the <a href="https://opensource.syracuse.edu/">Syracuse University Open Source Program Office’s</a> <a href="https://github.com/SU-OSPO/workshop-template">workshop template</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with ❤️ and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>